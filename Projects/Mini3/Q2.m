clc;
clear;
close all
%% Generating Data
% First Dataset
dataset_1 = [0      1       0       -19.00;...
             1      1.95    9.37    -17.95;...
             2      2.88    18.23   -16.90;...
             3      3.79    24.57   -15.85;...
             4      4.65    34.44   -14.80;...
             5      5.45    41.78   -13.75;...
             6      6.18    48.60   -12.70;...
             7      7.48    54.91   -11.65;...
             8      7.99    60.71   -10.60;...
             9      8.72    65.99   -9.55;...
             10     9.01    70.75   -8.50;...
             11     9.28    74.98   -7.45;...
             12     9.46    78.70   -6.40;...
             13     9.59    81.90   -5.34;...
             14     9.72    84.57   -4.30;...
             15     9.81    86.72   -3.25;...
             16     9.88    88.34   -2.20;...
             17     9.91    89.44   0];

% Second Dataset
dataset_2 = [0      1       90       11.5;...
             1      1.10    79.08    9.40;...
             2      1.29    74.40    8.35;...
             3      1.56    70.24    7.30;...
             4      1.90    66.60    6.25;...
             5      2.29    63.48    5.20;...
             6      2.73    60.88    4.15;...
             7      3.22    58.81    3.10;...
             8      3.74    57.26    2.05;...
             9      4.84    55.74   -0.05;...
             10     5.96    56.31   -2.15;...
             11     6.51    57.38   -3.20;...
             12     7.05    58.98   -4.25;...
             13     7.56    61.10   -5.30;...
             14     8.04    63.75   -6.35;...
             15     8.48    66.92   -7.40;...
             16     8.87    70.61   -8.45;...
             17     9.20    74.82   -7.40;...
             18     9.46    78.51   -6.35;...
             19     9.66    81.68   -5.30;...
             20     9.80    84.33   -4.25;...
             21     9.90    86.45   -3.20;...
             22     9.96    88.05   -2.15;...
             23     10.01   89.67    0];
x1 = [dataset_1(:,2); dataset_2(:,2)]
x2 = [dataset_1(:,3); dataset_2(:,3)]
y = [dataset_1(:,4); dataset_2(:,4)]
inputData = [x1 x2];
outputData = y;
disp("ok");
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
opt = genfisOptions('GridPartition');
opt.NumMembershipFunctions = [5 5];
opt.InputMembershipFunctionType = ["gaussmf" "gaussmf"];
%opt.OutputRange = [min(outputData), max(outputData)];
fis = genfis(inputData,outputData, opt);
fis.output.range = [-90, 90];  % Change the output range to -90 to 90
disp("ok");
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
trainingData = [inputData outputData];
options = anfisOptions('InitialFIS',fis);   
options.EpochNumber = 2000;
options.InitialStepSize = 0.2;
[fis,trainError,stepSize] = anfis(trainingData,options);
figure;
subplot(2, 1, 1);
plot(trainError);
subplot(2, 1, 2);
plot(stepSize);
x = 1;
Phi = 0;
theta = 0;
y = 0;
xs = [];
Phis = [];
ys = [];
thetas = [];
xs(end+1) = x;
Phis(end+1) = Phi;
thetas(end+1) = theta;
for i = 1 : 500
    theta = evalfis(fis, [x Phi]);
    [x, Phi] = next_phase(x, Phi, theta);
    xs(end+1) = x;  
    Phis(end+1) = Phi;
    thetas(end+1) = theta;
    if (x >= 9.5)
        break
    end
end

   